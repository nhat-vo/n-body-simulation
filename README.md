# N-Body Simulation

This repository contains the source code for a parallel N-Body simulator. A more descriptive description of the algorithms in this project is included in the report.
Here, we will give a brief introduction to the repository's structure.

## Instruction:
### Quickstart:
Run
```
make main DFLAGS=-DVISUALIZE
./main 3 1 1000
```
and a simulation will be saved in `image.gif`.

### Building:
The [Makefile](https://github.com/nhat-vo/n-body-simulation/blob/main/Makefile) contains several targets to build the project:
- `clean`: clean all the files generated by the build
- `main`: build the code into a `./main` executable
- `remote`: a useful build target to copy the code to a remote machine through `scp`, then compile the code. You can specify the remote machine in the `HOST` flag.

### Compile flags:
- In order to build the code with visualization, please add `-DVISUALIZE` in compilation. You can do this, for example, by uncommenting the `# DFLAGS = -DVISUALIZE` inside the Makefile.
Please note that this requires `imagemagick` installed, and the `Magick++config` script in `PATH`.
In addition, the visualization could be much slower compared to the actual computation, hence it is recommended to compile without this in benchmarking.
- The flag `-DDEBUG` could also be turned on for additional debug information. 
Currently, the only debug information being printed when this is turned on is when a body exits the universe scope in Barnes-Hut algorithm.

### Binary usage:
When run without any argument, `./main` will print out the usage like below:
```
‚ùØ ./main
Usage: ./main <algorithm id (default = 0)> <number of threads (default = 1)> <number of bodies (default = 100)>
Algorithms:
0: single-thread
1: multi-thread-1
2: multi-thread-2
3: barnes-hut
```
You can specify the algorithm, number of threads, and number of bodies for the simulation. Please note that for `single-thread` and `barnes-hut`, the number of threads will always be 1.

## Code structure:
The repository is structured as follows:
- `vect.hpp` defines a 2D vector class and common operations for use throughout the code.
- `common.hpp` defines several configuration such as simulation period, step size, etc.
- `visualizer.hpp` and `visualizer.cpp` defines the code for the visualization functionalities. A brief description of how to use this is included in `visualizer.hpp`.
- `algorithms.hpp` declares the available algorithms. 
In order to make the code more readable and avoid name collision, we only have the declaration here, and the implementation of each will be split into a separate file.
- `main.cpp` defines the argument parsing logic, constructs a scenario, then starts and times the simulation.

Currently, the default scenario is 1 very heavy object (the sun) at the middle of the canvas, and `number_of_bodies - 1` objects (planets) revolving around it, with 
their positions randomly distributed inside a square centered at the sun.
The planets' velocities are randomly generated so that (1) they moves in a counter-clockwise direction and (2) they orbits around the sun and neither escape nor crash into it.

A very simple scenario where a planet do a simple elliptical orbit around the sun is in the commented code in `main.cpp`.
In case you want to add/modify the scenario, please feel free to change the code in the `main.cpp` file.

## Gallery:
![1000 bodies spiraling around the sun](https://github.com/nhat-vo/n-body-simulation/blob/8c6317ca7d945acc58f24139f4c1a673f597bc1a/images/1000-bodies.gif)
![Bodies orbiting around the sun](https://github.com/nhat-vo/n-body-simulation/blob/8c6317ca7d945acc58f24139f4c1a673f597bc1a/image.gif)
![Binary stars](https://github.com/nhat-vo/n-body-simulation/blob/8c6317ca7d945acc58f24139f4c1a673f597bc1a/images/binary-stars-close.gif)
![Circular orbit](https://github.com/nhat-vo/n-body-simulation/blob/8c6317ca7d945acc58f24139f4c1a673f597bc1a/images/circle-orbit.gif)
